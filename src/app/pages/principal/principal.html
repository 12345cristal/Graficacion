<div class="pagina">
    <header class="encabezado">
        <div class="encabezado__izq">
            <div class="logo">
                <div class="logo__marca">R</div>
                <div class="logo__texto">
                    <div class="logo__titulo">Requify</div>
                    <div class="logo__subtitulo">Gestión de Requerimientos</div>
                </div>
            </div>
        </div>

        <div class="encabezado__der">
            <button type="button" class="btn btn--secundario"
                (click)="cerrarSesion()"
                matTooltip="Cerrar sesión">
                <mat-icon>logout</mat-icon>
                Cerrar Sesión
            </button>
        </div>
    </header>

    <main class="contenido">
        <section class="titulo">
            <h1>Tus Proyectos</h1>
            <p>Selecciona un proyecto para continuar o crea uno nuevo</p>
        </section>

        <section class="grid">
            <button type="button" class="card card--crear"
                (click)="abrirModalCrear()"
                matTooltip="Crear nuevo proyecto">
                <div class="card--crear__borde">
                    <div class="card--crear__centro">
                        <mat-icon class="plus">add_circle_outline</mat-icon>
                        <div class="card--crear__titulo">Crear Nuevo
                            Proyecto</div>
                        <div class="card--crear__desc">Comienza un nuevo
                            proyecto de requerimientos</div>
                    </div>
                </div>
            </button>

            <div class="lista">
                @for (p of proyectos(); track p.id) {
                <article
                    class="card card--proyecto"
                    tabindex="0"
                    role="button"
                    (click)="abrirProyecto(p)"
                    (keydown.enter)="abrirProyecto(p)"
                    (keydown.space)="abrirProyecto(p)">
                    <div class="card--proyecto__fila1">
                        <mat-icon class="icono-proyecto">folder</mat-icon>
                        <mat-icon class="flecha">chevron_right</mat-icon>
                    </div>

                    <div class="card--proyecto__nombre">{{ p.nombre }}</div>
                    <div class="card--proyecto__desc">{{ p.descripcion }}</div>

                    <div class="chips">
                        <div class="chip chip--claro">
                            <mat-icon class="chip__icono">settings</mat-icon>
                            <span class="chip__texto">Procesos</span>
                            <span class="chip__num">{{ p.procesos }}</span>
                        </div>

                        <div class="chip chip--azul">
                            <mat-icon class="chip__icono">people</mat-icon>
                            <span class="chip__texto">Stakeholders</span>
                            <span class="chip__num">{{ p.stakeholders }}</span>
                        </div>
                    </div>

                    <div class="fecha">
                        <mat-icon class="fecha__icono">calendar_today</mat-icon>
                        <span>Creado: {{ p.creadoEl }}</span>
                    </div>
                </article>
                }
            </div>
        </section>

        <button class="ayuda" type="button"
            matTooltip="Ayuda"
            matTooltipPosition="above">
            <mat-icon>help</mat-icon>
        </button>
    </main>

    @if (estaModalAbierta()) {
    <div class="overlay" (click)="cerrarModal()">
        <div
            class="modal"
            role="dialog"
            aria-modal="true"
            aria-labelledby="tituloModal"
            tabindex="0"
            (click)="$event.stopPropagation()"
            (keydown)="onKeydownModal($event)">
            <div class="modal__header">
                <div class="modal__titulo">
                    <mat-icon class="modal__icono">folder_open</mat-icon>
                    <h2 id="tituloModal">Crear Nuevo Proyecto</h2>
                </div>

                <button type="button" class="modal__cerrar"
                    (click)="cerrarModal()" aria-label="Cerrar">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <div class="modal__body">
                <label class="campo">
                    <span class="campo__label">Nombre del Proyecto
                        <b>*</b></span>
                    <input
                        class="campo__input"
                        type="text"
                        placeholder="Ej: Sistema de Gestión Hospitalaria"
                        [formControl]="nombreControl" />
                    @if (nombreControl.touched && nombreControl.invalid) {
                    <span class="campo__error">Ingresa un nombre válido (mínimo
                        3 caracteres).</span>
                    }
                </label>

                <label class="campo">
                    <span class="campo__label">Descripción General</span>
                    <textarea
                        class="campo__textarea"
                        rows="3"
                        placeholder="Describe brevemente el proyecto y sus objetivos..."
                        [formControl]="descripcionControl"></textarea>
                </label>

                <div class="consejo">
                    <mat-icon class="consejo__icono">lightbulb</mat-icon>
                    <div class="consejo__texto">
                        <b>Consejo:</b> Un buen nombre de proyecto debe ser
                        claro y descriptivo.
                        Podrás agregar procesos, stakeholders y técnicas de
                        recopilación después de crearlo.
                    </div>
                </div>
            </div>

            <div class="modal__footer">
                <button type="button" class="btn btn--secundario"
                    (click)="cerrarModal()">Cancelar</button>
                <button type="button" class="btn btn--primario"
                    (click)="crearProyecto()" [disabled]="estaCreando()">
                    Crear Proyecto
                </button>
            </div>
        </div>
    </div>
    }
</div>
